
## Convert the demo notebooks into restructured text

# This command finds non-hidden Jupyter notebooks in the directory `../demo`.
DEMO_FILES=`find ../demo -not -path '*/\.*' -type f -name '*\.ipynb'`

.PHONY: notebooks check-env

# This environment variable needs to be set in order to find the data sets used
# for some of the demos.
check-env:
ifndef ICEPACK_DATA
    $(error ICEPACK_DATA is undefined)
endif

source/index.rst:
	python3 make_index.py $(DEMO_FILES)

# For each demo, execute it with a 10-minute timeout, convert it to restructured
# text, and save the result in the `source` directory with `icepack.demo.`
# prepended to the name.
notebooks: check-env
	for filename in $(DEMO_FILES) ; do \
	    PYTHONPATH=`dirname $$filename` jupyter nbconvert \
	    --to rst \
	    --execute \
	    --ExecutePreprocessor.timeout=600 \
	    --output-dir=./source \
	    --output=icepack.demo.`basename $$filename | sed 's/ipynb/rst/g'` \
      $$filename ; \
	done


## Auto-generated by sphinx-quickstart

SPHINXOPTS    =
SPHINXBUILD   = sphinx-build
SPHINXPROJ    = icepack
SOURCEDIR     = source
BUILDDIR      = build

help:
	@$(SPHINXBUILD) -M help "$(SOURCEDIR)" "$(BUILDDIR)" $(SPHINXOPTS) $(O)

clean:
	rm -rf build source/icepack* source/index.rst source/modules.rst

.PHONY: help clean Makefile

html: Makefile notebooks source/index.rst
	@$(SPHINXBUILD) -M $@ "$(SOURCEDIR)" "$(BUILDDIR)" $(SPHINXOPTS) $(O)
